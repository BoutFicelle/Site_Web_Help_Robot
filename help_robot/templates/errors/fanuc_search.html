{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block title %}Help Robot - {% trans "Fanuc Error Search" %}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-10 mx-auto">
        <div class="text-center mb-4">
            <h2>🔍 {% trans "Fanuc Error Search" %}</h2>
            <p class="text-muted">{% trans "Enter an error code or keyword to find solutions" %}</p>
        </div>

        <!-- Search Form -->
        <div class="card mb-4">
            <div class="card-body">
                <form method="GET" class="d-flex flex-column" id="search-form">
                    <!-- Barre de recherche -->
                    <div class="d-flex mb-3">
                        <input type="text" 
                               name="q" 
                               value="{{ query }}" 
                               class="form-control me-2" 
                               placeholder="{% trans 'Enter error code (e.g., SRVO-001, ACAL-002)' %}"
                               autofocus>
                        <button type="submit" class="btn btn-primary">
                            {% trans "Search" %}
                        </button>
                    </div>
                    
                    <!-- Boutons de langue pour les erreurs SEULEMENT -->
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <small class="text-muted">
                                {% trans "Error results language:" %}
                            </small>
                        </div>
                        <div class="btn-group" role="group" id="error-language-switcher">
                            <input type="radio" class="btn-check" name="error_lang" value="en" id="error_lang_en" 
                                   {% if error_language == 'en' %}checked{% endif %}>
                            <label class="btn btn-outline-primary btn-sm" for="error_lang_en">
                                🇺🇸 English
                            </label>
                            
                            <input type="radio" class="btn-check" name="error_lang" value="fr" id="error_lang_fr"
                                   {% if error_language == 'fr' %}checked{% endif %}>
                            <label class="btn btn-outline-primary btn-sm" for="error_lang_fr">
                                🇫🇷 Français
                            </label>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Indicateur de langue des résultats -->
        {% if results %}
            <div class="alert alert-info d-flex justify-content-between align-items-center mb-3">
                <div>
                    {% blocktrans count counter=results|length %}
                        Found {{ counter }} result for "{{ query }}"
                    {% plural %}
                        Found {{ counter }} results for "{{ query }}"
                    {% endblocktrans %}
                </div>
                <div>
                    <small class="badge bg-secondary">
                        {% if error_language == 'fr' %}
                            {% trans "Results in French" %} 🇫🇷
                        {% else %}
                            {% trans "Results in English" %} 🇺🇸
                        {% endif %}
                    </small>
                </div>
            </div>
        {% endif %}

        <!-- Results -->
        {% if query %}
            {% if results %}
                {% for error in results %}
                <div class="card mb-3">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <span class="badge bg-primary me-2">{{ error.code }}</span>
                                {{ error.title }}
                            </h5>
                            
                            <!-- Bouton de basculement rapide pour cette erreur -->
                            <div class="btn-group btn-group-sm">
                                {% if error_language == 'fr' %}
                                    <a href="?q={{ query }}&error_lang=en" class="btn btn-outline-secondary btn-sm quick-lang-switch">
                                        🇺🇸 EN
                                    </a>
                                {% else %}
                                    <a href="?q={{ query }}&error_lang=fr" class="btn btn-outline-secondary btn-sm quick-lang-switch">
                                        🇫🇷 FR
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-danger">
                                    <i class="bi bi-exclamation-triangle"></i>
                                    {% trans "Cause" %}
                                </h6>
                                {% if error_language == 'fr' %}
                                    <p class="border-start border-danger ps-3">{{ error.cause_fr }}</p>
                                {% else %}
                                    <p class="border-start border-danger ps-3">{{ error.cause_en }}</p>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-success">
                                    <i class="bi bi-tools"></i>
                                    {% trans "Solution" %}
                                </h6>
                                {% if error_language == 'fr' %}
                                    <p class="border-start border-success ps-3">{{ error.remedy_fr }}</p>
                                {% else %}
                                    <p class="border-start border-success ps-3">{{ error.remedy_en }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
                
                <!-- Bouton pour changer la langue de tous les résultats -->
                <div class="text-center mt-4">
                    <div class="btn-group">
                        {% if error_language == 'fr' %}
                            <a href="?q={{ query }}&error_lang=en" class="btn btn-outline-primary quick-lang-switch">
                                🇺🇸 {% trans "View all results in English" %}
                            </a>
                        {% else %}
                            <a href="?q={{ query }}&error_lang=fr" class="btn btn-outline-primary quick-lang-switch">
                                🇫🇷 {% trans "View all results in French" %}
                            </a>
                        {% endif %}
                    </div>
                </div>
                
            {% else %}
                <div class="alert alert-warning text-center">
                    <h5>{% trans "No results found" %}</h5>
                    <p>{% trans "No errors found for" %} "<strong>{{ query }}</strong>"</p>
                    <p class="mb-0">{% trans "Try a different search term or check the error code format." %}</p>
                </div>
            {% endif %}
        {% else %}
            <div class="text-center text-muted">
                <div class="fs-1 mb-3">🔍</div>
                <p>{% trans "Enter an error code above to start searching" %}</p>
                <div class="mt-3">
                    <small class="text-muted">
                        {% trans "Examples:" %} <code>ACAL-001</code>, <code>SRVO</code>, <code>calibration</code>
                    </small>
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- JavaScript spécifique à la page de recherche Fanuc -->
<script src="{% static 'js/fanuc-search.js' %}"></script>
{% endblock %}